(this["webpackJsonpvisualizing-commuter-data"]=this["webpackJsonpvisualizing-commuter-data"]||[]).push([[7],{175:function(t,e,r){},247:function(t,e,r){"use strict";r.r(e);var a=r(99),n=r(108),o=r.n(n),c=r(5),i=r.n(c),s=r(97),u=r(226),l=r(228),p=r(176),f=r(241),d=r(221),O=r(222),b=r(223),v=r(224),m=r(225),h=r(227),E=r(231),T=r(173),j=r(234),_=r(237),g=r(244),N=r(199),y=r(245),D=r(198),C=r(13),A=r(20),S=r(54),M=r(242),w=r(239),U=r(53),I=r(64),k=r.n(I),L=(r(174),r(175),{}),R={},P={};var H=function(t){var e=t.setHoveredData,r=t.setHighlightedData,a=(t.centroidData,t.currentMap),n=t.currentCommuteTypes,s=t.setCurrentDestinationData,u=t.setClickedData,l=t.mapRef,p=[-41.273,173.299],f=k.a.latLng(-31.154944,150.138842),d=k.a.latLng(-49.285522,191.794907),O=Object(c.useState)([]),b=Object(S.a)(O,2),v=(b[0],b[1],Object(c.useRef)(!0),Object(c.useState)()),m=Object(S.a)(v,2),h=(m[0],m[1],Object(c.useState)({left:0,top:0,right:0,bottom:0})),E=Object(S.a)(h,2),T=(E[0],E[1]),j=Object(c.useState)([]),_=Object(S.a)(j,2),g=(_[0],_[1],Object(c.useState)([])),N=Object(S.a)(g,2),y=(N[0],N[1],Object(c.useState)("TOTAL")),D=Object(S.a)(y,2),I=D[0],H=D[1],W=Object(c.useState)({lat:p[0],lng:p[1],zoom:5}),Y=Object(S.a)(W,2),x=(Y[0],Y[1],Object(c.useState)(!1)),K=Object(S.a)(x,2),z=K[0],B=K[1],q=Object(c.useState)(null),F=Object(S.a)(q,2),Z=(F[0],F[1],Object(c.useState)(!0)),G=Object(S.a)(Z,2),V=(G[0],G[1]),J=Object(U.h)(),Q=Object(U.g)();Object(c.useEffect)((function(){k.a.control.scale().addTo(l.current.leafletElement),l.current.leafletElement.updateData=$}),[]),Object(c.useEffect)((function(){var t=J.pathname.match(/[\-0-9.]+\/[\-0-9.]+\/[\-0-9.]+$/);if(t&&t.length){var e=t[0].split("/")[0],r=t[0].split("/")[1],a=t[0].split("/")[2];z&&(l.current.leafletElement.setView([e,r],a),$(),B(!0)),V(!1)}}),[J]),Object(c.useEffect)((function(){H(a.option.toUpperCase()),l.current.leafletElement.commuteType=a.option.toUpperCase(),ot("WORK"===a.option.toUpperCase()?R:L,"WORK"===a.option.toUpperCase()?"EDUCATION":"WORK")}),[a.option]),Object(c.useEffect)((function(){l.current.leafletElement.off("movestart"),l.current.leafletElement.on("movestart",$),l.current.leafletElement.off("zoomend"),l.current.leafletElement.on("zoomend",X),X()}),[I,n]);var X=function(){$()},$=function(){u({}),s({from:"",to:""});var t=l.current.leafletElement,e=t.getBounds(),r=e.getCenter(),a=t.getZoom();Q.replace("/location/".concat(r.lat,"/").concat(r.lng,"/").concat(a)),"TOTAL"===I?(rt(e,a,"EDUCATION"),rt(e,a,"WORK")):rt(e,a,I)},tt=function(t){Object.keys(P).length&&P.remove(),P=it(Number(t.departure_LONGITUDE),Number(t.departure_LATITUDE),Number(t.destination_LONGITUDE),Number(t.destination_LATITUDE),t,!0)},et=function(t){switch(t){case"WORK_AT_HOME":case"STUDY_AT_HOME":return"Working/Studying from Home";case"DRIVE_OWN_VEHICLE":return"Driving own vehicle";case"PASSENGER_IN_VEHICLE":return"Passenger in vehicle (car/truck/van)";case"TRAIN":return"Train";case"BICYCLE":return"Bicycle";case"WALK_OR_JOG":return"Walking/Jogging";case"BUS":return"Bus";case"FERRY":return"Ferry";case"OTHER":default:return"Other"}},rt=function(t,e,r){var a,c,i,s,u,l,p;return o.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:for(T({top:t._northEast.lat,bottom:t._southWest.lat,left:t._southWest.lng,right:t._northEast.lng}),a="",c=!0,i=!1,s=void 0,f.prev=5,u=n[Symbol.iterator]();!(c=(l=u.next()).done);c=!0)p=l.value,a+="&commute_type="+("Stay home"===(d=p)?"home":"Drive own vehicle"===d?"own_vehicle":"Passenger in vehicle"===d?"passenger":"Train"===d?"train":"Bicycle"===d?"bicycle":"Walk or jog"===d?"walk_or_jog":"Bus"===d?"bus":"Ferry"===d?"ferry":"Ferry"===d||"Other"===d?"other":d);f.next=13;break;case 9:f.prev=9,f.t0=f.catch(5),i=!0,s=f.t0;case 13:f.prev=13,f.prev=14,c||null==u.return||u.return();case 16:if(f.prev=16,!i){f.next=19;break}throw s;case 19:return f.finish(16);case 20:return f.finish(13);case 21:fetch(C.h+"/zoneData?left=".concat(t._southWest.lng,"&top=").concat(t._northEast.lat,"&right=").concat(t._northEast.lng,"&bottom=").concat(t._southWest.lat,"&zoom=").concat(e,"&data_type=").concat(r.toLowerCase()).concat(a)).then((function(t){var e;return o.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,o.a.awrap(t.json());case 2:e=a.sent,"WORK"===r&&at(e,"WORK"),"EDUCATION"===r&&at(e,"EDUCATION");case 5:case"end":return a.stop()}}))})).catch((function(t){console.error("Error fetching data: ",t)}));case 22:case"end":return f.stop()}var d}),null,null,[[5,9,13,21],[14,,16,20]])},at=function(t,e){if(t)for(var r=nt(t,e),a=0,n=Object.keys(r);a<n.length;a++){var o=n[a],c=!0,i=!1,s=void 0;try{for(var u,l=r[o][Symbol.iterator]();!(c=(u=l.next()).done);c=!0){var p=u.value,f=it(Number(p.departure_LONGITUDE),Number(p.departure_LATITUDE),Number(p.destination_LONGITUDE),Number(p.destination_LATITUDE),p,!1);"WORK"===e?(L[o]||(L[o]={}),L[o][p.id]=f):"EDUCATION"===e&&(R[o]||(R[o]={}),R[o][p.id]=f)}}catch(d){i=!0,s=d}finally{try{c||null==l.return||l.return()}finally{if(i)throw s}}}},nt=function(t,e){for(var r={},a="WORK"===e?L:R,n=0,o=Object.keys(t);n<o.length;n++){var c=o[n];r[c]=[];var i=Object(A.f)(t[c]),s=!0,u=!1,l=void 0;try{for(var p,f=i[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var d=p.value;a[d.id]||r[c].push(d)}}catch(O){u=!0,l=O}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}}return ot(a,e),r},ot=function(t,e){for(var r=0,a=Object.keys(t);r<a.length;r++)for(var n=a[r],o=0,c=Object.keys(t[n]);o<c.length;o++){for(var i=c[o],s=0,u=Array.from(document.getElementsByClassName(i));s<u.length;s++){var l=u[s];l&&(l.classList.remove("pathFadeIn"),l.classList.add("pathFadeOut"),l.remove())}"WORK"===e?(L[n][i].remove(),L[n][i]=void 0,delete L[n][i]):"EDUCATION"===e&&(R[n][i].remove(),R[n][i]=void 0,delete R[n][i])}ct()},ct=function(){for(var t=0,e=Object.values(L);t<e.length;t++){var r=e[t];Object.keys(r).length}for(var a=0,n=Object.values(R);a<n.length;a++){r=n[a];Object.keys(r).length}},it=function(t,a,n,o,c,i){if(["STUDY_AT_HOME","WORK_AT_HOME"].includes(c.COMMUTE_TYPE))return function(t,e,r){var a=[t,e],n=.1*Number(r.COUNT)+2;return n*=Math.pow(18-l.current.leafletElement.getZoom(),1.6),k.a.circle(a,n,{color:"rgba(0,0,0,0)",fillColor:"#f54242",fillOpacity:.7}).on("mouseover",(function(t){ut(t,r)})).on("mousedown",(function(t){u(r),s({from:r.SA2_name_usual_residence_address,to:r.SA2_name_workplace_address})})).on("mouseout",(function(t){l.current.leafletElement.closePopup()})).addTo(l.current.leafletElement)}(a,t,c);var p=n-t,f=o-a,d=Math.sqrt(Math.pow(p,2)+Math.pow(f,2)),O=Math.atan2(f,p),b=d/2/Math.cos(.314),v=O+.314,m=b*Math.cos(v)+t,h=[b*Math.sin(v)+a,m];[].push([t,a],h,[n,o]);var E={color:C.e[C.i[c.COMMUTE_TYPE]],weight:i?.1*Number(c.COUNT)+1.5+3.5:1+.1*Number(c.COUNT),opacity:i?1:.75+.01*Number(c.COUNT)},T=k.a.curve(["M",[a,t],"Q",h,[o,n]],E).on("mouseover",(function(t){i||(this.setStyle({weight:3.5+.1*Number(c.COUNT),opacity:1}),e({hoveredData:c,hoveredDestination:c.destination_SA22018_V1_NAME}),r(c),st(t,c))})).on("mouseout",(function(){i||(this.setStyle({weight:1+.1*Number(c.COUNT),opacity:.75+.01*Number(c.COUNT)}),l.current.leafletElement.closePopup())})).on("mousedown",(function(){u(c),s({from:c.SA2_name_usual_residence_address,to:c.SA2_name_workplace_address}),tt(c)})).addTo(l.current.leafletElement);return T._path.classList.add(c.id),T._path.classList.add("pathFadeIn"),T},st=function(t,e){k.a.popup({closeButton:!1,autoPan:!1}).setLatLng(t.latlng).setContent("<p><b>"+e.DEPARTURE_NAME_1+", "+e.SA2_name_usual_residence_address+" \u2192 "+e.DESTINATION_NAME_1+", "+(e.SA2_name_workplace_address||e.SA2_name_educational_address)+"</p><p>"+Number(e.HAVERSINE_DISTANCE).toFixed(2)+'km <span class="'+e.COMMUTE_TYPE+'">'+et(e.COMMUTE_TYPE)+"</span></p></b><hr/><div><b>"+e.COUNT+"</b> people </div><p>Commuting for <b>"+e.TYPE.toLowerCase()+"</b></p>").openOn(l.current.leafletElement)},ut=function(t,e){k.a.popup({closeButton:!1,autoPan:!1}).setLatLng(t.latlng).setContent("<p><b>"+e.DEPARTURE_NAME_1+", "+e.SA2_name_usual_residence_address+'<p><span class="'+e.COMMUTE_TYPE+'">'+et(e.COMMUTE_TYPE)+"</span></p></b><hr/><div><b>"+e.COUNT+"</b> people </div><p>Commuting for <b>"+e.TYPE.toLowerCase()+"</b></p>").openOn(l.current.leafletElement)};return i.a.createElement(M.a,{ref:l,center:p,zoom:5,zoomControl:!0,maxBounds:k.a.latLngBounds(f,d),minZoom:5,maxZoom:18,layers:[]},i.a.createElement(w.a,{url:"https://api.maptiler.com/maps/basic/{z}/{x}/{y}.png?key=tYXqZFaglZBPM8w9KlP7",attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">\xa9 MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">\xa9 OpenStreetMap contributors</a>'}))},W=function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"0"},Y={confirmed:function(t){return Object(d.a)(.85*t)},active:function(t){return Object(O.a)(.85*t)},recovered:function(t){return Object(b.a)(.85*t)},deceased:function(t){return Object(v.a)(.85*t)},tested:function(t){return Object(m.a)(.85*t)}};e.default=function(t){var e=t.currentMap,r=t.data,n=t.regionalEducationData,d=t.regionalWorkData,O=t.regionalTotalData,b=t.centroidData,v=t.setRegionalData,m=t.currentView,S=t.setCurrentView,M=t.changeMap,w=t.regionHighlighted,U=t.setRegionHighlighted,I=t.setHoveredData,k=t.setHighlightedData,L=t.statistic,R=t.isCountryLoaded,P=t.currentCommuteTypes,x=t.setCurrentDestinationData,K=t.setClickedData,z=t.mapRef,B=(Object(y.a)().t,Object(c.useRef)(null)),q=C.n.NZ,F=Object(s.a)(q.geoDataFile,(function(t){return o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(Object(u.a)(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}))}),{revalidateOnFocus:!1,suspense:!0}).data,Z=Object(c.useMemo)((function(){var t=Object.keys(r).filter((function(t){return"NZ"!==t&&Object.keys(C.n).includes(t)}));return e.view===C.q.COUNTRY?Object(h.a)(t,(function(t){return W(r[t],L,e.option===C.o.PER_MILLION?C.j[t]:1)})):Object(h.a)(t,(function(t){var e;return(null===(e=r[t])||void 0===e?void 0:e.districts)?Object(h.a)(Object.values(r[t].districts),(function(t){return W(t,L)})):0}))}),[r,e.option,e.view,L]),G=Object(c.useMemo)((function(){return W(r[e.code],L,e.option===C.o.PER_MILLION?C.j[e.code]:1)}),[r,e.code,e.option,L]),V=Object(c.useMemo)((function(){return e.option===C.o.ZONES?Object(l.a)(Object.keys(C.v),Object.values(C.v)):e.option===C.o.HOTSPOTS?Object(p.b)([0,Math.max(Z,1)],[0,40]).clamp(!0).nice(3):Object(f.a)([0,Math.max(1,Z)],Y[L]).clamp(!0)}),[e.option,L,Z]);return Object(c.useEffect)((function(){}),[]),Object(c.useEffect)((function(){var t=D.a(F,F.objects[q.graphObjectStates||q.graphObjectDistricts]),o=Object(E.a)(B.current),c=Object(j.a)().fitSize([432,488],t),i=Object(_.a)(c),s=e.view===C.q.DISTRICT?D.a(F,F.objects[q.graphObjectStates]).features:q.mapType===C.q.COUNTRY&&e.option===C.o.HOTSPOTS?[].concat(Object(a.a)(D.a(F,F.objects[q.graphObjectStates]).features),Object(a.a)(D.a(F,F.objects[q.graphObjectDistricts]).features)):D.a(F,F.objects[q.graphObjectDistricts]).features;s=s.map((function(t){var r=Object.assign({},t);return r.id="".concat(e.code,"-").concat(t.properties.HASC_2),r}));var u=function(t){var a,n,o=C.a[t.properties.NAME_1],c=t.properties.NAME_2,i=r[o],s=null===i||void 0===i?void 0:null===(a=i.districts)||void 0===a?void 0:a[c];return 0===(n=e.option===C.o.HOTSPOTS?(null===s||void 0===s?void 0:s.zone)||0:c?W(s,L):W(i,L,e.option===C.o.PER_MILLION?C.j[o]:1))?"#ffffff00":V(n)},l=function(t){return"#000000"},p=function(t){return"#ffffff00"},f=Object(N.a)().duration(C.g),b=null;o.select(".regions").selectAll("path").data(e.option!==C.o.HOTSPOTS?s:[],(function(t){return t.id})).join((function(t){var r=t.append("path").attr("d",i).attr("stroke-width",C.t).attr("stroke-opacity",0).style("cursor","pointer").on("mouseenter",(function(t){U({districtCode:C.a[t.properties.NAME_2],cityName:t.properties.NAME_2}),v(function(t){switch(e.option){case C.o.TOTAL:return(O||{})[t];case C.o.WORK:return(d||{})[t];case C.o.EDUCATION:return(n||{})[t];default:return(O||{})[t]}}(t.properties.NAME_2))})).on("mouseleave",(function(t){b===t&&(b=null)})).on("touchstart",(function(t){b=b===t?null:t})).attr("fill",p).attr("stroke",l);return r.append("title"),r}),(function(t){return t.call((function(t){return t.transition(f).attr("fill",u).attr("stroke",l)}))})).attr("pointer-events","all").on("click",(function(t){var e;S({view:C.q.DISTRICT}),T.b.stopPropagation();var a=C.a[t.properties.NAME_2];!function(t){var e,r,a,n=null;if(t&&n!==t){var c=i.centroid(t);e=c[0],r=c[1],a=9,n=t}else e=216,r=244,a=1,n=null;o.selectAll("path").classed("active",n&&function(t){return t===n}),o.transition().duration(C.g).attr("transform","translate("+a/2*432+","+a/2.15*488+")scale("+a+")translate("+-e+","+-r+")")}(t),!b&&q.mapType!==C.q.COUNTRY&&(null===(e=r[a])||void 0===e?void 0:e.NAME_2)&&(o.attr("pointer-events","none"),o.select(".regions").selectAll("path").attr("pointer-events","none"))})).select("title").text((function(t){if(e.option===C.o.TOTAL){var a,n=t.properties.NAME_1,o=C.a[n],c=t.properties.NAME_2,i=r[o],s=null===i||void 0===i?void 0:null===(a=i.city)||void 0===a?void 0:a[c];return W(c?s:i,L),Object(A.a)(c||n)}})),o.transition().duration(q.mapType===C.q.DISTRICT?f.duration()/2:0).on("end",(function(){return o.attr("class",e.option===C.o.HOTSPOTS?"zone":"")})),o.selectAll("path.route").remove(),o.selectAll("circle.pin").remove(),Object.keys(r).forEach((function(t){var e="workMapData"===t?C.v.Red:C.c.active;o.selectAll(".routes").data(r[t]).enter().append("path").attr("class","route").attr("cursor","pointer").attr("fill-opacity",.5).attr("stroke",e).attr("stroke-width",C.p).attr("fill",e).attr("d",(function(t){var e=[t.departure_LONGITUDE,t.departure_LATITUDE],r=[t.destination_LONGITUDE,t.destination_LATITUDE];return i({type:"LineString",coordinates:[e,r]})})).on("mouseenter",(function(t){var e=D.a(F,F.objects[q.graphObjectDistricts]).features,r=!0,a=!1,n=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var i=o.value;if(Object(g.a)(i,[t.destination_LONGITUDE,t.destination_LATITUDE])){I({hoveredData:t,hoveredDestination:i.properties.NAME_1});break}}}catch(s){a=!0,n=s}finally{try{r||null==c.return||c.return()}finally{if(a)throw n}}}))})),Object.keys(r).forEach((function(t){var e="workMapData"===t?C.v.Red:C.c.active;o.selectAll(".pin").data(r[t]).enter().append("circle",".pin").on("mouseenter",(function(t){console.log("circle hovered: ",t),I({hoveredData:t,hoveredDestination:""})})).attr("class","pin").attr("cursor","pointer").attr("r",C.l).attr("fill",e).attr("transform",(function(t){return"translate("+c([t.departure_LONGITUDE,t.departure_LATITUDE])+")"}))}));var h=[];q.mapType===C.q.COUNTRY&&((h=[D.b(F,F.objects[q.graphObjectStates])])[0].id=q.graphObjectStates);e.view===C.q.DISTRICT&&([D.b(F,F.objects[q.graphObjectDistricts])][0].id=q.graphObjectDistricts),o.select(".state-borders").attr("fill","none").attr("stroke-width",(function(){return m.view===C.q.COUNTRY?.25:.15})).selectAll("path").data(h,(function(t){return t.id})).join((function(t){return t.append("path").attr("d",i)})).transition(f).attr("stroke",(function(){return e.option===C.o.ZONES?"#00000060":C.c[L]+"30"})),o.select(".state-borders").selectAll("path").data(h,(function(t){return t.id})).join((function(t){return t.append("path").attr("d",i).attr("fill","none").attr("stroke-width",.05)})).transition(f).attr("stroke","#343a4050"),o.attr("pointer-events","auto").on("click",(function(){q.mapType!==C.q.COUNTRY&&U({districtCode:"NZ",cityName:null})}))}),[F,r,q,e,U,M,R,V,L,G]),Object(c.useEffect)((function(){C.b[w.districtCode];var t=w.cityName;Object(E.a)(B.current).select(".regions").selectAll("path").each((function(e){var r=t===e.properties.NAME_2;r&&this.parentNode.appendChild(this),Object(E.a)(this).attr("stroke-opacity",r?1:0),Object(E.a)(this).attr("fill-opacity",r?.95:0),Object(E.a)(this).attr("fill",r?"#000000":0)}))}),[F,r,e.option,e.view,w.districtCode,w.cityName,L]),i.a.createElement(i.a.Fragment,null,i.a.createElement(H,{setHoveredData:I,setHighlightedData:k,currentMap:e,centroidData:b,currentCommuteTypes:P,setCurrentDestinationData:x,setClickedData:K,mapRef:z}))}}}]);
//# sourceMappingURL=MapVisualizer.cd57b20f.chunk.js.map