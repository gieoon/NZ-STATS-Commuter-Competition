(this["webpackJsonpvisualizing-commuter-data"]=this["webpackJsonpvisualizing-commuter-data"]||[]).push([[6],{164:function(t,e,r){"use strict";(function(t){var a=r(104),n=r.n(a),o=r(55),i=r(5),c=r.n(i),s=r(234),u=r(231),l=r(53),p=r(62),f=r.n(p),d=(r(165),r(166),r(13)),O=r(20),h=(r(167),{}),v={};t.commuteWorkCurves=h,t.commuteEducationCurves=v,e.a=function(t){var e=t.setHoveredData,r=t.setHighlightedData,a=(t.centroidData,t.currentMap),p=(t.history,t.currentCommuteTypes),b=t.setCurrentDestinationData,m=[-41.273,173.299],j=f.a.latLng(-31.154944,150.138842),E=f.a.latLng(-49.285522,191.794907),T=Object(i.useState)([]),g=Object(o.a)(T,2),_=(g[0],g[1],Object(i.useRef)(null)),y=(Object(i.useRef)(!0),Object(i.useState)()),N=Object(o.a)(y,2),D=(N[0],N[1],Object(i.useState)({left:0,top:0,right:0,bottom:0})),A=Object(o.a)(D,2),C=(A[0],A[1]),S=Object(i.useState)([]),w=Object(o.a)(S,2),M=(w[0],w[1],Object(i.useState)([])),I=Object(o.a)(M,2),k=(I[0],I[1],Object(i.useState)("TOTAL")),U=Object(o.a)(k,2),R=U[0],L=U[1],H=Object(i.useState)({lat:m[0],lng:m[1]}),W=Object(o.a)(H,2),x=(W[0],W[1]),P=Object(i.useState)(null),Y=Object(o.a)(P,2),K=(Y[0],Y[1],Object(i.useState)(!0)),z=Object(o.a)(K,2),B=z[0],F=z[1],V=Object(l.h)();Object(i.useEffect)((function(){f.a.control.scale().addTo(_.current.leafletElement)}),[]),Object(i.useEffect)((function(){var t=V.pathname.match(/[\-0-9.]+\/[\-0-9.]+$/);if(t&&t.length){var e=t[0].split("/")[0],r=t[0].split("/")[1];x({lat:e,lng:r}),B||(_.current.leafletElement.setView([e,r],12),G()),F(!1)}}),[V]),Object(i.useEffect)((function(){L(a.option.toUpperCase()),_.current.leafletElement.commuteType=a.option.toUpperCase(),q("WORK"===a.option.toUpperCase()?v:h,"WORK"===a.option.toUpperCase()?"EDUCATION":"WORK")}),[a.option]),Object(i.useEffect)((function(){_.current.leafletElement.off("movestart"),_.current.leafletElement.on("movestart",G),_.current.leafletElement.off("zoomstart"),_.current.leafletElement.on("zoomstart",G),G()}),[R,p]);var G=function(){var t=_.current.leafletElement,e=t.getBounds(),r=t.getZoom();"TOTAL"===R?(Z(e,r,"EDUCATION"),Z(e,r,"WORK")):Z(e,r,R)},Z=function(t,e,r){var a,o,i,c,s,u,l;return n.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:for(C({top:t._northEast.lat,bottom:t._southWest.lat,left:t._southWest.lng,right:t._northEast.lng}),a="",o=!0,i=!1,c=void 0,f.prev=5,s=p[Symbol.iterator]();!(o=(u=s.next()).done);o=!0)l=u.value,a+="&commute_type="+("Stay home"===(O=l)?"home":"Drive own vehicle"===O?"own_vehicle":"Passenger in vehicle"===O?"passenger":"Train"===O?"train":"Bicycle"===O?"bicycle":"Walk or jog"===O?"walk_or_jog":"Bus"===O?"bus":"Ferry"===O?"ferry":"Ferry"===O||"Other"===O?"other":O);f.next=13;break;case 9:f.prev=9,f.t0=f.catch(5),i=!0,c=f.t0;case 13:f.prev=13,f.prev=14,o||null==s.return||s.return();case 16:if(f.prev=16,!i){f.next=19;break}throw c;case 19:return f.finish(16);case 20:return f.finish(13);case 21:fetch(d.g+"/zoneData?left=".concat(t._southWest.lng,"&top=").concat(t._northEast.lat,"&right=").concat(t._northEast.lng,"&bottom=").concat(t._southWest.lat,"&zoom=").concat(e,"&data_type=").concat(r.toLowerCase()).concat(a)).then((function(t){var e;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.awrap(t.json());case 2:e=a.sent,"WORK"===r&&J(e,"WORK"),"EDUCATION"===r&&J(e,"EDUCATION");case 5:case"end":return a.stop()}}))})).catch((function(t){console.error("Error fetching data: ",t)}));case 22:case"end":return f.stop()}var O}),null,null,[[5,9,13,21],[14,,16,20]])},J=function(t,e){if(t)for(var r=Q(t,e),a=0,n=Object.keys(r);a<n.length;a++){var o=n[a],i=!0,c=!1,s=void 0;try{for(var u,l=r[o][Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var p=u.value,f=X(Number(p.departure_LONGITUDE),Number(p.departure_LATITUDE),Number(p.destination_LONGITUDE),Number(p.destination_LATITUDE),p,e);"WORK"===e?(h[o]||(h[o]={}),h[o][p.id]=f):"EDUCATION"===e&&(v[o]||(v[o]={}),v[o][p.id]=f)}}catch(d){c=!0,s=d}finally{try{i||null==l.return||l.return()}finally{if(c)throw s}}}},Q=function(t,e){for(var r={},a="WORK"===e?h:v,n=0,o=Object.keys(t);n<o.length;n++){var i=o[n];r[i]=[];var c=Object(O.g)(t[i]),s=!0,u=!1,l=void 0;try{for(var p,f=c[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var d=p.value;a[d.id]||r[i].push(d)}}catch(b){u=!0,l=b}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}}return q(a,e),r},q=function(t,e){for(var r=0,a=Object.keys(t);r<a.length;r++)for(var n=a[r],o=0,i=Object.keys(t[n]);o<i.length;o++){for(var c=i[o],s=0,u=Array.from(document.getElementsByClassName(c));s<u.length;s++){var l=u[s];l&&(l.classList.remove("pathFadeIn"),l.classList.add("pathFadeOut"),l.remove())}"WORK"===e?(h[n][c].remove(),h[n][c]=void 0,delete h[n][c]):"EDUCATION"===e&&(v[n][c].remove(),v[n][c]=void 0,delete v[n][c])}$()},$=function(){for(var t=0,e=Object.values(h);t<e.length;t++){var r=e[t];Object.keys(r).length}for(var a=0,n=Object.values(v);a<n.length;a++){r=n[a];Object.keys(r).length}},X=function(t,a,n,o,i,c){if(["STUDY_AT_HOME","WORK_AT_HOME"].includes(i.COMMUTE_TYPE))return function(t,e,r){console.log("creating stay at home data");var a=[t,e],n=3.25*Number(r.COUNT)+250;return f.a.circle(a,n,{weight:1.5,color:"#f54242",fillColor:"#f54242",fillOpacity:.35}).addTo(_.current.leafletElement)}(a,t,i);var s=n-t,u=o-a,l=Math.sqrt(Math.pow(s,2)+Math.pow(u,2)),p=Math.atan2(u,s),O=l/2/Math.cos(.314),h=p+.314,v=O*Math.cos(h)+t,m=[O*Math.sin(h)+a,v];[].push([t,a],m,[n,o]);var j={color:d.d[d.h[i.COMMUTE_TYPE]],weight:1+.1*Number(i.COUNT),opacity:.35+.01*Number(i.COUNT)},E=f.a.curve(["M",[a,t],"Q",m,[o,n]],j).on("mouseover",(function(t){this.setStyle({weight:3.5+.1*Number(i.COUNT),opacity:1}),e({hoveredData:i,hoveredDestination:i.destination_SA22018_V1_NAME}),b({from:i.SA2_name_usual_residence_address,to:i.SA2_name_workplace_address}),r(i),f.a.popup({closeButton:!1}).setLatLng(t.latlng).setContent("<p><b>"+i.DEPARTURE_NAME_1+", "+i.SA2_name_usual_residence_address+" \u2192 "+i.DESTINATION_NAME_1+", "+(i.SA2_name_workplace_address||i.SA2_name_educational_address)+"</p><p>"+Number(i.HAVERSINE_DISTANCE).toFixed(2)+'km</p></b><hr/><div style="display:flex;justify-content:space-between;"><div><b>'+i.COUNT+'</b> people </div><div><span class="'+i.COMMUTE_TYPE+'">'+function(t){switch(t){case"STAY_HOME":return"Working/Studying from Home";case"DRIVE_OWN_VEHICLE":return"Driving own vehicle";case"PASSENGER_IN_VEHICLE":return"Passenger in vehicle (car/truck/van)";case"TRAIN":return"Train";case"BICYCLE":return"Bicycle";case"WALK_OR_JOG":return"Walking/Jogging";case"BUS":return"Bus";case"FERRY":return"Ferry";case"OTHER":default:return"Other"}}(i.COMMUTE_TYPE)+"</span></div></div><p>Commuting for <b>"+i.TYPE.toLowerCase()+"</b></p>").openOn(_.current.leafletElement)})).on("mouseout",(function(){this.setStyle({weight:1+.1*Number(i.COUNT),opacity:.35+.01*Number(i.COUNT)}),_.current.leafletElement.closePopup()})).addTo(_.current.leafletElement);return E._path.classList.add(i.id),E._path.classList.add("pathFadeIn"),E};return c.a.createElement(s.a,{ref:_,center:m,zoom:5,zoomControl:!0,maxBounds:f.a.latLngBounds(j,E),minZoom:5,maxZoom:18,layers:[]},c.a.createElement(u.a,{url:"https://api.maptiler.com/maps/basic/{z}/{x}/{y}.png?key=9Ada5vIEJbJjNQrKmV7i",attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">\xa9 MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">\xa9 OpenStreetMap contributors</a>'}))}}).call(this,r(36))},166:function(t,e,r){},167:function(t,e,r){t.exports=r.p+"static/media/right.0aea0b24.svg"},211:function(t,e,r){"use strict";r.r(e);var a=r(93),n=r(104),o=r.n(n),i=r(5),c=r.n(i),s=r(115),u=r(217),l=r(219),p=r(168),f=r(233),d=r(212),O=r(213),h=r(214),v=r(215),b=r(216),m=r(218),j=r(222),E=r(163),T=r(225),g=r(228),_=r(236),y=r(192),N=r(238),D=r(191),A=r(13),C=r(20),S=r(164),w=function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"0"},M={confirmed:function(t){return Object(d.a)(.85*t)},active:function(t){return Object(O.a)(.85*t)},recovered:function(t){return Object(h.a)(.85*t)},deceased:function(t){return Object(v.a)(.85*t)},tested:function(t){return Object(b.a)(.85*t)}};e.default=function(t){var e=t.currentMap,r=t.data,n=t.regionalEducationData,d=t.regionalWorkData,O=t.regionalTotalData,h=t.centroidData,v=t.setRegionalData,b=t.currentView,I=t.setCurrentView,k=t.changeMap,U=t.regionHighlighted,R=t.setRegionHighlighted,L=t.setHoveredData,H=t.setHighlightedData,W=t.statistic,x=t.isCountryLoaded,P=t.currentCommuteTypes,Y=t.setCurrentDestinationData,K=(t.leafletMapRef,Object(N.a)().t,Object(i.useRef)(null)),z=A.m.NZ,B=Object(s.a)(z.geoDataFile,(function(t){return o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(Object(u.a)(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}))}),{revalidateOnFocus:!1,suspense:!0}).data,F=Object(i.useMemo)((function(){var t=Object.keys(r).filter((function(t){return"NZ"!==t&&Object.keys(A.m).includes(t)}));return e.view===A.p.COUNTRY?Object(m.a)(t,(function(t){return w(r[t],W,e.option===A.n.PER_MILLION?A.i[t]:1)})):Object(m.a)(t,(function(t){var e;return(null===(e=r[t])||void 0===e?void 0:e.districts)?Object(m.a)(Object.values(r[t].districts),(function(t){return w(t,W)})):0}))}),[r,e.option,e.view,W]),V=Object(i.useMemo)((function(){return w(r[e.code],W,e.option===A.n.PER_MILLION?A.i[e.code]:1)}),[r,e.code,e.option,W]),G=Object(i.useMemo)((function(){return e.option===A.n.ZONES?Object(l.a)(Object.keys(A.u),Object.values(A.u)):e.option===A.n.HOTSPOTS?Object(p.b)([0,Math.max(F,1)],[0,40]).clamp(!0).nice(3):Object(f.a)([0,Math.max(1,F)],M[W]).clamp(!0)}),[e.option,W,F]);return Object(i.useEffect)((function(){}),[]),Object(i.useEffect)((function(){var t=D.a(B,B.objects[z.graphObjectStates||z.graphObjectDistricts]),o=Object(j.a)(K.current),i=Object(T.a)().fitSize([432,488],t),c=Object(g.a)(i),s=e.view===A.p.DISTRICT?D.a(B,B.objects[z.graphObjectStates]).features:z.mapType===A.p.COUNTRY&&e.option===A.n.HOTSPOTS?[].concat(Object(a.a)(D.a(B,B.objects[z.graphObjectStates]).features),Object(a.a)(D.a(B,B.objects[z.graphObjectDistricts]).features)):D.a(B,B.objects[z.graphObjectDistricts]).features;s=s.map((function(t){var r=Object.assign({},t);return r.id="".concat(e.code,"-").concat(t.properties.HASC_2),r}));var u=function(t){var a,n,o=A.a[t.properties.NAME_1],i=t.properties.NAME_2,c=r[o],s=null===c||void 0===c?void 0:null===(a=c.districts)||void 0===a?void 0:a[i];return 0===(n=e.option===A.n.HOTSPOTS?(null===s||void 0===s?void 0:s.zone)||0:i?w(s,W):w(c,W,e.option===A.n.PER_MILLION?A.i[o]:1))?"#ffffff00":G(n)},l=function(t){return"#000000"},p=function(t){return"#ffffff00"},f=Object(y.a)().duration(A.f),h=null;o.select(".regions").selectAll("path").data(e.option!==A.n.HOTSPOTS?s:[],(function(t){return t.id})).join((function(t){var r=t.append("path").attr("d",c).attr("stroke-width",A.s).attr("stroke-opacity",0).style("cursor","pointer").on("mouseenter",(function(t){R({districtCode:A.a[t.properties.NAME_2],cityName:t.properties.NAME_2}),v(function(t){switch(e.option){case A.n.TOTAL:return(O||{})[t];case A.n.WORK:return(d||{})[t];case A.n.EDUCATION:return(n||{})[t];default:return(O||{})[t]}}(t.properties.NAME_2))})).on("mouseleave",(function(t){h===t&&(h=null)})).on("touchstart",(function(t){h=h===t?null:t})).attr("fill",p).attr("stroke",l);return r.append("title"),r}),(function(t){return t.call((function(t){return t.transition(f).attr("fill",u).attr("stroke",l)}))})).attr("pointer-events","all").on("click",(function(t){var e;I({view:A.p.DISTRICT}),E.b.stopPropagation();var a=A.a[t.properties.NAME_2];!function(t){var e,r,a,n=null;if(t&&n!==t){var i=c.centroid(t);e=i[0],r=i[1],a=9,n=t}else e=216,r=244,a=1,n=null;o.selectAll("path").classed("active",n&&function(t){return t===n}),o.transition().duration(A.f).attr("transform","translate("+a/2*432+","+a/2.15*488+")scale("+a+")translate("+-e+","+-r+")")}(t),!h&&z.mapType!==A.p.COUNTRY&&(null===(e=r[a])||void 0===e?void 0:e.NAME_2)&&(o.attr("pointer-events","none"),o.select(".regions").selectAll("path").attr("pointer-events","none"))})).select("title").text((function(t){if(e.option===A.n.TOTAL){var a,n=t.properties.NAME_1,o=A.a[n],i=t.properties.NAME_2,c=r[o],s=null===c||void 0===c?void 0:null===(a=c.city)||void 0===a?void 0:a[i];return w(i?s:c,W),Object(C.a)(i||n)}})),o.transition().duration(z.mapType===A.p.DISTRICT?f.duration()/2:0).on("end",(function(){return o.attr("class",e.option===A.n.HOTSPOTS?"zone":"")})),o.selectAll("path.route").remove(),o.selectAll("circle.pin").remove(),Object.keys(r).forEach((function(t){var e="workMapData"===t?A.u.Red:A.c.active;o.selectAll(".routes").data(r[t]).enter().append("path").attr("class","route").attr("cursor","pointer").attr("fill-opacity",.5).attr("stroke",e).attr("stroke-width",A.o).attr("fill",e).attr("d",(function(t){var e=[t.departure_LONGITUDE,t.departure_LATITUDE],r=[t.destination_LONGITUDE,t.destination_LATITUDE];return c({type:"LineString",coordinates:[e,r]})})).on("mouseenter",(function(t){var e=D.a(B,B.objects[z.graphObjectDistricts]).features,r=!0,a=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var c=o.value;if(Object(_.a)(c,[t.destination_LONGITUDE,t.destination_LATITUDE])){L({hoveredData:t,hoveredDestination:c.properties.NAME_1});break}}}catch(s){a=!0,n=s}finally{try{r||null==i.return||i.return()}finally{if(a)throw n}}}))})),Object.keys(r).forEach((function(t){var e="workMapData"===t?A.u.Red:A.c.active;o.selectAll(".pin").data(r[t]).enter().append("circle",".pin").on("mouseenter",(function(t){console.log("circle hovered: ",t),L({hoveredData:t,hoveredDestination:""})})).attr("class","pin").attr("cursor","pointer").attr("r",A.k).attr("fill",e).attr("transform",(function(t){return"translate("+i([t.departure_LONGITUDE,t.departure_LATITUDE])+")"}))}));var m=[];z.mapType===A.p.COUNTRY&&((m=[D.b(B,B.objects[z.graphObjectStates])])[0].id=z.graphObjectStates);e.view===A.p.DISTRICT&&([D.b(B,B.objects[z.graphObjectDistricts])][0].id=z.graphObjectDistricts),o.select(".state-borders").attr("fill","none").attr("stroke-width",(function(){return b.view===A.p.COUNTRY?.25:.15})).selectAll("path").data(m,(function(t){return t.id})).join((function(t){return t.append("path").attr("d",c)})).transition(f).attr("stroke",(function(){return e.option===A.n.ZONES?"#00000060":A.c[W]+"30"})),o.select(".state-borders").selectAll("path").data(m,(function(t){return t.id})).join((function(t){return t.append("path").attr("d",c).attr("fill","none").attr("stroke-width",.05)})).transition(f).attr("stroke","#343a4050"),o.attr("pointer-events","auto").on("click",(function(){z.mapType!==A.p.COUNTRY&&R({districtCode:"NZ",cityName:null})}))}),[B,r,z,e,R,k,x,G,W,V]),Object(i.useEffect)((function(){A.b[U.districtCode];var t=U.cityName;Object(j.a)(K.current).select(".regions").selectAll("path").each((function(e){var r=t===e.properties.NAME_2;r&&this.parentNode.appendChild(this),Object(j.a)(this).attr("stroke-opacity",r?1:0),Object(j.a)(this).attr("fill-opacity",r?.95:0),Object(j.a)(this).attr("fill",r?"#000000":0)}))}),[B,r,e.option,e.view,U.districtCode,U.cityName,W]),c.a.createElement(c.a.Fragment,null,c.a.createElement(S.a,{setHoveredData:L,setHighlightedData:H,currentMap:e,centroidData:h,currentCommuteTypes:P,setCurrentDestinationData:Y}))}}}]);
//# sourceMappingURL=MapVisualizer.37e51f9d.chunk.js.map