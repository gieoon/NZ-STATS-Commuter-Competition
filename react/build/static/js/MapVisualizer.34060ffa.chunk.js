(this["webpackJsonpvisualizing-commuter-data"]=this["webpackJsonpvisualizing-commuter-data"]||[]).push([[7],{174:function(t,e,r){"use strict";(function(t){var a=r(108),n=r.n(a),o=r(54),c=r(5),i=r.n(c),s=r(244),u=r(241),l=r(53),p=r(64),f=r.n(p),d=(r(175),r(176),r(13)),O=r(20),b={},m={},v={};t.commuteWorkCurves=b,t.commuteEducationCurves=m,e.a=function(t){var e=t.setHoveredData,r=t.setHighlightedData,a=(t.centroidData,t.currentMap),p=t.currentCommuteTypes,h=t.setCurrentDestinationData,E=t.setClickedData,T=t.mapRef,j=[-41.273,173.299],_=f.a.latLng(-31.154944,150.138842),g=f.a.latLng(-49.285522,191.794907),N=Object(c.useState)([]),y=Object(o.a)(N,2),D=(y[0],y[1],Object(c.useRef)(!0),Object(c.useState)()),C=Object(o.a)(D,2),A=(C[0],C[1],Object(c.useState)({left:0,top:0,right:0,bottom:0})),S=Object(o.a)(A,2),M=(S[0],S[1]),w=Object(c.useState)([]),U=Object(o.a)(w,2),k=(U[0],U[1],Object(c.useState)([])),I=Object(o.a)(k,2),L=(I[0],I[1],Object(c.useState)("TOTAL")),R=Object(o.a)(L,2),P=R[0],H=R[1],W=Object(c.useState)({lat:j[0],lng:j[1],zoom:5}),Y=Object(o.a)(W,2),x=(Y[0],Y[1],Object(c.useState)(!1)),K=Object(o.a)(x,2),z=K[0],B=K[1],q=Object(c.useState)(null),F=Object(o.a)(q,2),Z=(F[0],F[1],Object(c.useState)(!0)),G=Object(o.a)(Z,2),V=(G[0],G[1]),J=Object(l.h)(),Q=Object(l.g)();Object(c.useEffect)((function(){f.a.control.scale().addTo(T.current.leafletElement),T.current.leafletElement.updateData=$}),[]),Object(c.useEffect)((function(){var t=J.pathname.match(/[\-0-9.]+\/[\-0-9.]+\/[\-0-9.]+$/);if(t&&t.length){var e=t[0].split("/")[0],r=t[0].split("/")[1],a=t[0].split("/")[2];z&&(T.current.leafletElement.setView([e,r],a),$(),B(!0)),V(!1)}}),[J]),Object(c.useEffect)((function(){H(a.option.toUpperCase()),T.current.leafletElement.commuteType=a.option.toUpperCase(),ot("WORK"===a.option.toUpperCase()?m:b,"WORK"===a.option.toUpperCase()?"EDUCATION":"WORK")}),[a.option]),Object(c.useEffect)((function(){T.current.leafletElement.off("movestart"),T.current.leafletElement.on("movestart",$),T.current.leafletElement.off("zoomend"),T.current.leafletElement.on("zoomend",X),X()}),[P,p]);var X=function(){$()},$=function(){E({}),h({from:"",to:""});var t=T.current.leafletElement,e=t.getBounds(),r=e.getCenter(),a=t.getZoom();Q.replace("/location/".concat(r.lat,"/").concat(r.lng,"/").concat(a)),"TOTAL"===P?(rt(e,a,"EDUCATION"),rt(e,a,"WORK")):rt(e,a,P)},tt=function(t){Object.keys(v).length&&v.remove(),v=it(Number(t.departure_LONGITUDE),Number(t.departure_LATITUDE),Number(t.destination_LONGITUDE),Number(t.destination_LATITUDE),t,!0)},et=function(t){switch(t){case"WORK_AT_HOME":case"STUDY_AT_HOME":return"Working/Studying from Home";case"DRIVE_OWN_VEHICLE":return"Driving own vehicle";case"PASSENGER_IN_VEHICLE":return"Passenger in vehicle (car/truck/van)";case"TRAIN":return"Train";case"BICYCLE":return"Bicycle";case"WALK_OR_JOG":return"Walking/Jogging";case"BUS":return"Bus";case"FERRY":return"Ferry";case"OTHER":default:return"Other"}},rt=function(t,e,r){var a,o,c,i,s,u,l;return n.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:for(M({top:t._northEast.lat,bottom:t._southWest.lat,left:t._southWest.lng,right:t._northEast.lng}),a="",o=!0,c=!1,i=void 0,f.prev=5,s=p[Symbol.iterator]();!(o=(u=s.next()).done);o=!0)l=u.value,a+="&commute_type="+("Stay home"===(O=l)?"home":"Drive own vehicle"===O?"own_vehicle":"Passenger in vehicle"===O?"passenger":"Train"===O?"train":"Bicycle"===O?"bicycle":"Walk or jog"===O?"walk_or_jog":"Bus"===O?"bus":"Ferry"===O?"ferry":"Ferry"===O||"Other"===O?"other":O);f.next=13;break;case 9:f.prev=9,f.t0=f.catch(5),c=!0,i=f.t0;case 13:f.prev=13,f.prev=14,o||null==s.return||s.return();case 16:if(f.prev=16,!c){f.next=19;break}throw i;case 19:return f.finish(16);case 20:return f.finish(13);case 21:fetch(d.h+"/zoneData?left=".concat(t._southWest.lng,"&top=").concat(t._northEast.lat,"&right=").concat(t._northEast.lng,"&bottom=").concat(t._southWest.lat,"&zoom=").concat(e,"&data_type=").concat(r.toLowerCase()).concat(a)).then((function(t){var e;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.awrap(t.json());case 2:e=a.sent,"WORK"===r&&at(e,"WORK"),"EDUCATION"===r&&at(e,"EDUCATION");case 5:case"end":return a.stop()}}))})).catch((function(t){console.error("Error fetching data: ",t)}));case 22:case"end":return f.stop()}var O}),null,null,[[5,9,13,21],[14,,16,20]])},at=function(t,e){if(t)for(var r=nt(t,e),a=0,n=Object.keys(r);a<n.length;a++){var o=n[a],c=!0,i=!1,s=void 0;try{for(var u,l=r[o][Symbol.iterator]();!(c=(u=l.next()).done);c=!0){var p=u.value,f=it(Number(p.departure_LONGITUDE),Number(p.departure_LATITUDE),Number(p.destination_LONGITUDE),Number(p.destination_LATITUDE),p,!1);"WORK"===e?(b[o]||(b[o]={}),b[o][p.id]=f):"EDUCATION"===e&&(m[o]||(m[o]={}),m[o][p.id]=f)}}catch(d){i=!0,s=d}finally{try{c||null==l.return||l.return()}finally{if(i)throw s}}}},nt=function(t,e){for(var r={},a="WORK"===e?b:m,n=0,o=Object.keys(t);n<o.length;n++){var c=o[n];r[c]=[];var i=Object(O.f)(t[c]),s=!0,u=!1,l=void 0;try{for(var p,f=i[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var d=p.value;a[d.id]||r[c].push(d)}}catch(v){u=!0,l=v}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}}return ot(a,e),r},ot=function(t,e){for(var r=0,a=Object.keys(t);r<a.length;r++)for(var n=a[r],o=0,c=Object.keys(t[n]);o<c.length;o++){for(var i=c[o],s=0,u=Array.from(document.getElementsByClassName(i));s<u.length;s++){var l=u[s];l&&(l.classList.remove("pathFadeIn"),l.classList.add("pathFadeOut"),l.remove())}"WORK"===e?(b[n][i].remove(),b[n][i]=void 0,delete b[n][i]):"EDUCATION"===e&&(m[n][i].remove(),m[n][i]=void 0,delete m[n][i])}ct()},ct=function(){for(var t=0,e=Object.values(b);t<e.length;t++){var r=e[t];Object.keys(r).length}for(var a=0,n=Object.values(m);a<n.length;a++){r=n[a];Object.keys(r).length}},it=function(t,a,n,o,c,i){if(["STUDY_AT_HOME","WORK_AT_HOME"].includes(c.COMMUTE_TYPE))return function(t,e,r){var a=[t,e],n=.1*Number(r.COUNT)+2;return n*=Math.pow(18-T.current.leafletElement.getZoom(),1.6),f.a.circle(a,n,{color:"rgba(0,0,0,0)",fillColor:"#f54242",fillOpacity:.7}).on("mouseover",(function(t){ut(t,r)})).on("mousedown",(function(t){E(r),h({from:r.SA2_name_usual_residence_address,to:r.SA2_name_workplace_address})})).on("mouseout",(function(t){T.current.leafletElement.closePopup()})).addTo(T.current.leafletElement)}(a,t,c);var s=n-t,u=o-a,l=Math.sqrt(Math.pow(s,2)+Math.pow(u,2)),p=Math.atan2(u,s),O=l/2/Math.cos(.314),b=p+.314,m=O*Math.cos(b)+t,v=[O*Math.sin(b)+a,m];[].push([t,a],v,[n,o]);var j={color:d.e[d.i[c.COMMUTE_TYPE]],weight:i?.1*Number(c.COUNT)+1.5+3.5:1+.1*Number(c.COUNT),opacity:i?1:.75+.01*Number(c.COUNT)},_=f.a.curve(["M",[a,t],"Q",v,[o,n]],j).on("mouseover",(function(t){i||(this.setStyle({weight:3.5+.1*Number(c.COUNT),opacity:1}),e({hoveredData:c,hoveredDestination:c.destination_SA22018_V1_NAME}),r(c),st(t,c))})).on("mouseout",(function(){i||(this.setStyle({weight:1+.1*Number(c.COUNT),opacity:.75+.01*Number(c.COUNT)}),T.current.leafletElement.closePopup())})).on("mousedown",(function(){E(c),h({from:c.SA2_name_usual_residence_address,to:c.SA2_name_workplace_address}),tt(c)})).addTo(T.current.leafletElement);return _._path.classList.add(c.id),_._path.classList.add("pathFadeIn"),_},st=function(t,e){f.a.popup({closeButton:!1,autoPan:!1}).setLatLng(t.latlng).setContent("<p><b>"+e.DEPARTURE_NAME_1+", "+e.SA2_name_usual_residence_address+" \u2192 "+e.DESTINATION_NAME_1+", "+(e.SA2_name_workplace_address||e.SA2_name_educational_address)+"</p><p>"+Number(e.HAVERSINE_DISTANCE).toFixed(2)+'km <span class="'+e.COMMUTE_TYPE+'">'+et(e.COMMUTE_TYPE)+"</span></p></b><hr/><div><b>"+e.COUNT+"</b> people </div><p>Commuting for <b>"+e.TYPE.toLowerCase()+"</b></p>").openOn(T.current.leafletElement)},ut=function(t,e){f.a.popup({closeButton:!1,autoPan:!1}).setLatLng(t.latlng).setContent("<p><b>"+e.DEPARTURE_NAME_1+", "+e.SA2_name_usual_residence_address+'<p><span class="'+e.COMMUTE_TYPE+'">'+et(e.COMMUTE_TYPE)+"</span></p></b><hr/><div><b>"+e.COUNT+"</b> people </div><p>Commuting for <b>"+e.TYPE.toLowerCase()+"</b></p>").openOn(T.current.leafletElement)};return i.a.createElement(s.a,{ref:T,center:j,zoom:5,zoomControl:!0,maxBounds:f.a.latLngBounds(_,g),minZoom:5,maxZoom:18,layers:[]},i.a.createElement(u.a,{url:"https://api.maptiler.com/maps/basic/{z}/{x}/{y}.png?key=tYXqZFaglZBPM8w9KlP7",attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">\xa9 MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">\xa9 OpenStreetMap contributors</a>'}))}}).call(this,r(36))},176:function(t,e,r){},222:function(t,e,r){"use strict";r.r(e);var a=r(99),n=r(108),o=r.n(n),c=r(5),i=r.n(c),s=r(97),u=r(228),l=r(230),p=r(177),f=r(243),d=r(223),O=r(224),b=r(225),m=r(226),v=r(227),h=r(229),E=r(233),T=r(173),j=r(236),_=r(239),g=r(246),N=r(200),y=r(247),D=r(199),C=r(13),A=r(20),S=r(174),M=function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"0"},w={confirmed:function(t){return Object(d.a)(.85*t)},active:function(t){return Object(O.a)(.85*t)},recovered:function(t){return Object(b.a)(.85*t)},deceased:function(t){return Object(m.a)(.85*t)},tested:function(t){return Object(v.a)(.85*t)}};e.default=function(t){var e=t.currentMap,r=t.data,n=t.regionalEducationData,d=t.regionalWorkData,O=t.regionalTotalData,b=t.centroidData,m=t.setRegionalData,v=t.currentView,U=t.setCurrentView,k=t.changeMap,I=t.regionHighlighted,L=t.setRegionHighlighted,R=t.setHoveredData,P=t.setHighlightedData,H=t.statistic,W=t.isCountryLoaded,Y=t.currentCommuteTypes,x=t.setCurrentDestinationData,K=t.setClickedData,z=t.mapRef,B=(Object(y.a)().t,Object(c.useRef)(null)),q=C.n.NZ,F=Object(s.a)(q.geoDataFile,(function(t){return o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(Object(u.a)(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}))}),{revalidateOnFocus:!1,suspense:!0}).data,Z=Object(c.useMemo)((function(){var t=Object.keys(r).filter((function(t){return"NZ"!==t&&Object.keys(C.n).includes(t)}));return e.view===C.q.COUNTRY?Object(h.a)(t,(function(t){return M(r[t],H,e.option===C.o.PER_MILLION?C.j[t]:1)})):Object(h.a)(t,(function(t){var e;return(null===(e=r[t])||void 0===e?void 0:e.districts)?Object(h.a)(Object.values(r[t].districts),(function(t){return M(t,H)})):0}))}),[r,e.option,e.view,H]),G=Object(c.useMemo)((function(){return M(r[e.code],H,e.option===C.o.PER_MILLION?C.j[e.code]:1)}),[r,e.code,e.option,H]),V=Object(c.useMemo)((function(){return e.option===C.o.ZONES?Object(l.a)(Object.keys(C.v),Object.values(C.v)):e.option===C.o.HOTSPOTS?Object(p.b)([0,Math.max(Z,1)],[0,40]).clamp(!0).nice(3):Object(f.a)([0,Math.max(1,Z)],w[H]).clamp(!0)}),[e.option,H,Z]);return Object(c.useEffect)((function(){}),[]),Object(c.useEffect)((function(){var t=D.a(F,F.objects[q.graphObjectStates||q.graphObjectDistricts]),o=Object(E.a)(B.current),c=Object(j.a)().fitSize([432,488],t),i=Object(_.a)(c),s=e.view===C.q.DISTRICT?D.a(F,F.objects[q.graphObjectStates]).features:q.mapType===C.q.COUNTRY&&e.option===C.o.HOTSPOTS?[].concat(Object(a.a)(D.a(F,F.objects[q.graphObjectStates]).features),Object(a.a)(D.a(F,F.objects[q.graphObjectDistricts]).features)):D.a(F,F.objects[q.graphObjectDistricts]).features;s=s.map((function(t){var r=Object.assign({},t);return r.id="".concat(e.code,"-").concat(t.properties.HASC_2),r}));var u=function(t){var a,n,o=C.a[t.properties.NAME_1],c=t.properties.NAME_2,i=r[o],s=null===i||void 0===i?void 0:null===(a=i.districts)||void 0===a?void 0:a[c];return 0===(n=e.option===C.o.HOTSPOTS?(null===s||void 0===s?void 0:s.zone)||0:c?M(s,H):M(i,H,e.option===C.o.PER_MILLION?C.j[o]:1))?"#ffffff00":V(n)},l=function(t){return"#000000"},p=function(t){return"#ffffff00"},f=Object(N.a)().duration(C.g),b=null;o.select(".regions").selectAll("path").data(e.option!==C.o.HOTSPOTS?s:[],(function(t){return t.id})).join((function(t){var r=t.append("path").attr("d",i).attr("stroke-width",C.t).attr("stroke-opacity",0).style("cursor","pointer").on("mouseenter",(function(t){L({districtCode:C.a[t.properties.NAME_2],cityName:t.properties.NAME_2}),m(function(t){switch(e.option){case C.o.TOTAL:return(O||{})[t];case C.o.WORK:return(d||{})[t];case C.o.EDUCATION:return(n||{})[t];default:return(O||{})[t]}}(t.properties.NAME_2))})).on("mouseleave",(function(t){b===t&&(b=null)})).on("touchstart",(function(t){b=b===t?null:t})).attr("fill",p).attr("stroke",l);return r.append("title"),r}),(function(t){return t.call((function(t){return t.transition(f).attr("fill",u).attr("stroke",l)}))})).attr("pointer-events","all").on("click",(function(t){var e;U({view:C.q.DISTRICT}),T.b.stopPropagation();var a=C.a[t.properties.NAME_2];!function(t){var e,r,a,n=null;if(t&&n!==t){var c=i.centroid(t);e=c[0],r=c[1],a=9,n=t}else e=216,r=244,a=1,n=null;o.selectAll("path").classed("active",n&&function(t){return t===n}),o.transition().duration(C.g).attr("transform","translate("+a/2*432+","+a/2.15*488+")scale("+a+")translate("+-e+","+-r+")")}(t),!b&&q.mapType!==C.q.COUNTRY&&(null===(e=r[a])||void 0===e?void 0:e.NAME_2)&&(o.attr("pointer-events","none"),o.select(".regions").selectAll("path").attr("pointer-events","none"))})).select("title").text((function(t){if(e.option===C.o.TOTAL){var a,n=t.properties.NAME_1,o=C.a[n],c=t.properties.NAME_2,i=r[o],s=null===i||void 0===i?void 0:null===(a=i.city)||void 0===a?void 0:a[c];return M(c?s:i,H),Object(A.a)(c||n)}})),o.transition().duration(q.mapType===C.q.DISTRICT?f.duration()/2:0).on("end",(function(){return o.attr("class",e.option===C.o.HOTSPOTS?"zone":"")})),o.selectAll("path.route").remove(),o.selectAll("circle.pin").remove(),Object.keys(r).forEach((function(t){var e="workMapData"===t?C.v.Red:C.c.active;o.selectAll(".routes").data(r[t]).enter().append("path").attr("class","route").attr("cursor","pointer").attr("fill-opacity",.5).attr("stroke",e).attr("stroke-width",C.p).attr("fill",e).attr("d",(function(t){var e=[t.departure_LONGITUDE,t.departure_LATITUDE],r=[t.destination_LONGITUDE,t.destination_LATITUDE];return i({type:"LineString",coordinates:[e,r]})})).on("mouseenter",(function(t){var e=D.a(F,F.objects[q.graphObjectDistricts]).features,r=!0,a=!1,n=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var i=o.value;if(Object(g.a)(i,[t.destination_LONGITUDE,t.destination_LATITUDE])){R({hoveredData:t,hoveredDestination:i.properties.NAME_1});break}}}catch(s){a=!0,n=s}finally{try{r||null==c.return||c.return()}finally{if(a)throw n}}}))})),Object.keys(r).forEach((function(t){var e="workMapData"===t?C.v.Red:C.c.active;o.selectAll(".pin").data(r[t]).enter().append("circle",".pin").on("mouseenter",(function(t){console.log("circle hovered: ",t),R({hoveredData:t,hoveredDestination:""})})).attr("class","pin").attr("cursor","pointer").attr("r",C.l).attr("fill",e).attr("transform",(function(t){return"translate("+c([t.departure_LONGITUDE,t.departure_LATITUDE])+")"}))}));var h=[];q.mapType===C.q.COUNTRY&&((h=[D.b(F,F.objects[q.graphObjectStates])])[0].id=q.graphObjectStates);e.view===C.q.DISTRICT&&([D.b(F,F.objects[q.graphObjectDistricts])][0].id=q.graphObjectDistricts),o.select(".state-borders").attr("fill","none").attr("stroke-width",(function(){return v.view===C.q.COUNTRY?.25:.15})).selectAll("path").data(h,(function(t){return t.id})).join((function(t){return t.append("path").attr("d",i)})).transition(f).attr("stroke",(function(){return e.option===C.o.ZONES?"#00000060":C.c[H]+"30"})),o.select(".state-borders").selectAll("path").data(h,(function(t){return t.id})).join((function(t){return t.append("path").attr("d",i).attr("fill","none").attr("stroke-width",.05)})).transition(f).attr("stroke","#343a4050"),o.attr("pointer-events","auto").on("click",(function(){q.mapType!==C.q.COUNTRY&&L({districtCode:"NZ",cityName:null})}))}),[F,r,q,e,L,k,W,V,H,G]),Object(c.useEffect)((function(){C.b[I.districtCode];var t=I.cityName;Object(E.a)(B.current).select(".regions").selectAll("path").each((function(e){var r=t===e.properties.NAME_2;r&&this.parentNode.appendChild(this),Object(E.a)(this).attr("stroke-opacity",r?1:0),Object(E.a)(this).attr("fill-opacity",r?.95:0),Object(E.a)(this).attr("fill",r?"#000000":0)}))}),[F,r,e.option,e.view,I.districtCode,I.cityName,H]),i.a.createElement(i.a.Fragment,null,i.a.createElement(S.a,{setHoveredData:R,setHighlightedData:P,currentMap:e,centroidData:b,currentCommuteTypes:Y,setCurrentDestinationData:x,setClickedData:K,mapRef:z}))}}}]);
//# sourceMappingURL=MapVisualizer.34060ffa.chunk.js.map